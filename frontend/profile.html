<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch h·ªì s∆°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
 <nav class="navbar navbar-expand-lg navbar-dark bg-primary px-4">
    <a class="navbar-brand fw-bold" href="index.html">üè£ ƒêƒÇNG K√ù DOANH NGHI·ªÜP</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-center">
        <li class="nav-item"><a href="index.html" class="nav-link text-white">Trang ch·ªß</a></li>
        <li class="nav-item"><a href="components/gioi-thieu.html" class="nav-link text-white">Gi·ªõi thi·ªáu</a></li>
        <li class="nav-item"><a href="components/dich-vu-cong.html" class="nav-link text-white">D·ªãch v·ª• c√¥ng</a></li>
        <li class="nav-item"><a href="components/ho-tro.html" class="nav-link text-white">H·ªó tr·ª£</a></li>
        <li class="nav-item"><a href="components/van-ban-phap-luat.html" class="nav-link text-white">VƒÉn b·∫£n ph√°p lu·∫≠t</a></li>
      </ul>

      <form class="d-flex ms-3 me-2" role="search">
        <input class="form-control form-control-sm" type="search" placeholder="T√¨m ki·∫øm..." aria-label="Search">
      </form>

      <a href="login.html" class="btn btn-outline-light btn-sm me-2">ƒêƒÉng nh·∫≠p</a>
      <a href="register.html" class="btn btn-light btn-sm">ƒêƒÉng k√Ω</a>
    </div>
  </nav>
<div class="container my-5">
  <h2 class="text-center mb-4">üìÑ Danh s√°ch h·ªì s∆° ƒëƒÉng k√Ω doanh nghi·ªáp</h2>

  <!-- üîç T√¨m ki·∫øm -->
  <div class="input-group mb-4">
    <input type="text" id="searchInput" class="form-control" placeholder="üîç T√¨m theo t√™n doanh nghi·ªáp...">
    <button class="btn btn-primary" onclick="searchHoSo()">T√¨m ki·∫øm</button>
    <button class="btn btn-secondary" onclick="resetSearch()">L√†m m·ªõi</button>
  </div>

  <!-- üìù B·∫£ng hi·ªÉn th·ªã -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped align-middle text-center">
      <thead class="table-primary">
        <tr>
          <th>STT</th>
          <th>T√™n doanh nghi·ªáp</th>
          <th>M√£ s·ªë thu·∫ø</th>
          <th>ƒê·ªãa ch·ªâ</th>
          <th>Ng∆∞·ªùi ƒë·∫°i di·ªán</th>
          <th>SƒêT</th>
          <th>Email</th>
          <th>File</th>
          <th>Ng√†y t·∫°o</th>
        </tr>
      </thead>
      <tbody id="hoSoTableBody">
        <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JS -->
      </tbody>
    </table>
  </div>

  <div id="responseMessage" class="mt-3"></div>
</div>

<!-- JS -->
<script>
  let danhSachGoc = [];

  // H√†m t·∫£i danh s√°ch h·ªì s∆° t·ª´ API
  async function loadHoSo() {
    const body = document.getElementById("hoSoTableBody");
    const msg = document.getElementById("responseMessage");

    try {
      const res = await fetch("http://localhost:5229/api/DangKy/danhsach");
      if (!res.ok) throw new Error(await res.text());

      const data = await res.json();
      danhSachGoc = data;
      renderHoSo(data);
    } catch (err) {
      console.error("‚ùå L·ªói t·∫£i danh s√°ch:", err);
      msg.innerHTML = `<div class="alert alert-danger">L·ªói t·∫£i danh s√°ch h·ªì s∆°: ${err.message}</div>`;
    }
  }

  // H√†m render b·∫£ng h·ªì s∆°
  function renderHoSo(data) {
  const body = document.getElementById("hoSoTableBody");

  if (!Array.isArray(data) || data.length === 0) {
    body.innerHTML = `<tr><td colspan="9" class="text-center text-muted">Kh√¥ng c√≥ h·ªì s∆° n√†o.</td></tr>`;
    return;
  }

  body.innerHTML = data.map((hoso, index) => {
    const ngay = hoso.ngayTao ? new Date(hoso.ngayTao) : null;
    const ngayFormatted = ngay
      ? `${ngay.getDate().toString().padStart(2, '0')}/${(ngay.getMonth() + 1).toString().padStart(2, '0')}/${ngay.getFullYear()} ${ngay.getHours().toString().padStart(2, '0')}:${ngay.getMinutes().toString().padStart(2, '0')}:${ngay.getSeconds().toString().padStart(2, '0')}`
      : "Ch∆∞a r√µ";

    return `
      <tr>
        <td>${index + 1}</td>
        <td>${hoso.tenDoanhNghiep}</td>
        <td>${hoso.maSoThue}</td>
        <td>${hoso.diaChiTruSo}</td>
        <td>${hoso.nguoiDaiDien}</td>
        <td>${hoso.soDienThoai}</td>
        <td>${hoso.emailLienHe}</td>
        <td>
          ${
            hoso.duongDanFile
              ? `<a href="http://localhost:5229${hoso.duongDanFile}" target="_blank">${hoso.tenFileUpload || 'T·∫£i file'}</a>`
              : 'Kh√¥ng c√≥'
          }
        </td>
        <td>${ngayFormatted}</td>
      </tr>
    `;
  }).join("");
}


  // H√†m t√¨m ki·∫øm theo t√™n doanh nghi·ªáp
  function searchHoSo() {
    const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
    const ketQua = danhSachGoc.filter(h =>
      h.tenDoanhNghiep && h.tenDoanhNghiep.toLowerCase().includes(keyword)
    );
    renderHoSo(ketQua);
  }

  // H√†m reset k·∫øt qu·∫£ t√¨m ki·∫øm
  function resetSearch() {
    document.getElementById("searchInput").value = '';
    renderHoSo(danhSachGoc);
  }

  // T·∫£i d·ªØ li·ªáu khi trang load
  window.onload = loadHoSo;
</script>

</body>
</html>
